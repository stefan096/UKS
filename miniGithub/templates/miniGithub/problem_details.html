{% extends "miniGithub/base_with_jquery.html" %}
{% load humanize %}
{% block body_block %}
  <h3>
    {{ problem.title }}
    &nbsp;
    <i class="text-muted">
      #{{ problem.id }}
    </i>
  </h3>
  <p class="text-muted">
    <strong> {{ problem.reported_by }} </strong>
    reported this problem {{ problem.created_time|naturaltime }}
  </p>
  <hr />
  <div>

    {% for comment in comments %}
      <div class="panel panel-default">
        <div class="panel-heading" style="position: relative;">
          <strong class="panel-title">
            {{ comment.creator }}
          </strong>
          <span class="text-muted">
            commented {{ comment.created_time|naturaltime }}
          </span>
            {% if comment.editCounts != 0 %}
                <span class="text-muted" style="padding: 0px 5px;">â€¢</span>
                <div class="dropup" style="display: inline-block;">
                  <button style="padding: 0px; border: none; background-color: inherit; color: #777;" class="btn btn-default dropdown-toggle" type="button" id="dropdown_{{comment.id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    edited by {{ comment.edits.last.creator }}
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="dropdown_{{comment.id}}" style="min-width: 250px;">
                    <li style="padding: 5px 15px;">
                      <span class="text-muted">
                        Edited {{comment.editCounts}}
                        {% if comment.editCounts == 1 %}
                          time
                          {% else %}
                          times
                          {% endif %}
                      </span>
                    </li>
                    {% for edit in comment.editsSorted %}
                      <li style="padding: 5px 10px;border-top: 1px solid rgba(0,0,0,0.1);">
                        <b>{{edit.creator}} </b> edited {{ edit.created_time|naturaltime }}
                      </li>
                    {% endfor %}
                    <li style="padding: 5px 10px;border-top: 1px solid rgba(0,0,0,0.1);">
                      <b>{{comment.creator}} </b> created {{ comment.created_time|naturaltime }}
                    </li>
                  </ul>
                </div>
            {% endif %}
          </span>

          <div style="position: absolute;right:10px;top:5px;">
            <a href="comments/{{ comment.id }}/edit/">
              <button type="button" class="btn btn-default btn-md">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
              </button>
            </a>
          </div>
        </div>
        <div class="panel-body">
          <p>
            {{ comment.description }}
          </p>
        </div>
      </div>
    {% endfor %}
  </div>
  <hr />
  <form action="add_comment/" method="post">
    {% csrf_token %}
    <div class="panel panel-default">
      <div class="panel-body">
        <div class="form-group">
          <label for="comment">Leave a comment:</label>
          <textarea class="form-control" name="comment"></textarea>
        </div>
      </div>
      <div class="panel-footer">
          <input class="btn btn-success" type="submit" name="" value="Comment">
             {% if problem.is_open %}
              <a href="close/">
                <button class="btn btn-default" type="button">
                  Close issue
                </button>
              </a>
            {% else %}
              <a href="reopen/">
                <button class="btn btn-default" type="button">
                  Reopen issue
                </button>
              </a>
            {% endif %}
      </div>
    </div>
  </form>
{% endblock %}

